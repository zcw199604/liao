# 变更提案: ui-theme-media-menu-fix

## 元信息
```yaml
类型: 修复
方案类型: implementation
优先级: P1
状态: 已完成
创建: 2026-01-31
```

---

## 1. 需求

### 背景
- 切换到浅色主题后，“图片管理”（侧边栏设置抽屉）中的媒体入口卡片使用了半透明深色渐变背景 + 固定白字/浅灰字，导致在浅色底上对比度不足，出现“字体被背景吞掉/看不清”。
- Android Via 浏览器移动端打开“所有上传图片”弹窗时，头部一行内内容过多（标题 + 计数 + 筛选按钮 + 右侧操作按钮），Flex 挤压导致标题/筛选按钮逐字换行，表现为“竖排”（每个字一行）。

### 目标
- 浅色主题下，“图片管理”入口区域文字清晰可读；深色主题视觉尽量保持现状。
- 移动端（Android Via）相关弹窗头部不出现逐字换行/竖排；小屏下控件仍可操作。

### 约束条件
```yaml
时间约束: 无
性能约束: 仅做 CSS/Tailwind 类调整，不引入重度动画或额外计算
兼容性约束: 至少覆盖 Android Via/Chrome；不破坏桌面端布局；深色主题保持现有视觉风格
业务约束: 不改后端接口/数据结构，仅调整展示层样式与布局
```

### 验收标准
- [x] `npm -C frontend run build` 通过
- [x] `npm -C frontend test` 通过
- [ ] Android Via + Android Chrome 真机验证：浅色主题下“图片管理”入口卡片文字清晰；“所有上传图片”弹窗头部不出现竖排且控件可操作

---

## 2. 方案

### 技术方案
1) 图片管理入口卡片（`SettingsDrawer.vue`）
- 为媒体入口卡片增加“深色实底”作为渐变基底（例如 `bg-slate-900` / `bg-gray-900`），避免透明渐变在浅色底上被“抬亮”，从而导致白字对比度不足。
- 将副标题/提示类文案从固定 `text-gray-400/500` 改为更适配深色底的 `text-white/70`（或 `text-white/60`），保证对比度与一致性。
- 备选：若希望深色主题仍保留半透明质感，可用 `dark:` 前缀保留原透明渐变，而浅色主题使用不透明渐变/实底。

2) 移动端标题竖排（`AllUploadImageModal.vue`）
- 对标题、计数、筛选按钮等关键文本增加 `whitespace-nowrap` + `shrink-0`，避免 Flex 挤压时逐字换行。
- 将头部区域改为响应式分行：`flex-col sm:flex-row`，小屏下把标题行与筛选行拆开；筛选区使用 `overflow-x-auto no-scrollbar`（或 `flex-wrap`）保证可操作性。
- 仅在必要处调整移动端间距（例如 `px-4 sm:px-6`、`gap-y-*`），尽量不影响桌面端布局。

### 影响范围
```yaml
涉及模块:
  - frontend/settings: “图片管理”入口卡片样式（主题对比度）
  - frontend/media: “所有上传图片”弹窗头部布局（移动端换行策略）
预计变更文件: 2-3
```

### 风险评估
| 风险 | 等级 | 应对 |
|------|------|------|
| 卡片视觉风格变化（浅色/深色差异更明显） | 中 | 限定只改“图片管理”入口卡片；必要时使用 `dark:` 维持深色主题质感；回归检查关键截图 |
| `whitespace-nowrap` 导致内容溢出/被遮挡 | 中 | 小屏下改为分行/横向滚动；必要处补 `min-w-0` 与 `overflow-x-auto` |
| Android 不同浏览器/WebView 行为差异 | 低 | Via + Chrome 双验证；若仍异常再补充更保守的布局策略（强制分行） |

---

## 3. 技术设计（可选）

### 架构设计
- 不涉及（仅前端样式/布局调整）

### API设计
- 不涉及

### 数据模型
- 不涉及

---

## 4. 核心场景

> 执行完成后同步到对应模块文档

### 场景: 浅色主题图片管理入口可读性
**模块**: frontend/settings
**条件**: 用户主题为浅色（或 auto 且系统为浅色），打开侧边栏设置抽屉 → 图片管理
**行为**: 查看媒体库入口卡片的标题/副标题/提示文案
**结果**: 文字清晰可读，背景不影响识别；hover 状态依然可辨

### 场景: 移动端弹窗头部不竖排
**模块**: frontend/media
**条件**: Android Via 浏览器，打开“所有上传图片”弹窗
**行为**: 查看头部标题/计数/筛选按钮，切换来源（全部/本地/抖音）
**结果**: 标题与筛选按钮不出现逐字换行；小屏下通过分行或横向滚动保持可操作

---

## 5. 技术决策

> 本方案涉及的技术决策，归档后成为决策的唯一完整记录

### ui-theme-media-menu-fix#D001: 图片管理卡片使用“深色基底 + 渐变”保证对比度
**日期**: 2026-01-31
**状态**: ✅采纳
**背景**: 当前卡片背景使用透明渐变（如 `from-*-900/40`），在浅色主题下会被白底抬亮，导致 `text-white` / `text-gray-400` 对比度不足
**选项分析**:
| 选项 | 优点 | 缺点 |
|------|------|------|
| A: 仅调文字颜色（浅色主题改深色字） | 视觉更贴合浅色主题 | 需要在同一组件里写大量 `dark:`/条件类，卡片设计感下降 |
| B: 增加深色实底作为透明渐变基底（推荐） | 改动小；白字对比度稳定；深色主题视觉几乎不变 | 浅色主题下卡片更“重”，与周围浅色对比更强 |
**决策**: 选择方案 B
**理由**: 最小改动即可稳定对比度，且能保留既有“深色卡片”视觉语言
**影响**: `frontend/src/components/settings/SettingsDrawer.vue`

### ui-theme-media-menu-fix#D002: 移动端头部采用“禁止逐字换行 + 响应式分行/滚动”
**日期**: 2026-01-31
**状态**: ✅采纳
**背景**: 小屏下头部同一行内容过多，Flex 挤压触发逐字换行（表现为竖排），影响可用性
**选项分析**:
| 选项 | 优点 | 缺点 |
|------|------|------|
| A: 给关键文本加 `whitespace-nowrap shrink-0` | 改动小，直接阻止竖排 | 可能造成溢出，需要配合分行/滚动 |
| B: 仅缩小字体/减少 padding | 成本低 | 仍可能挤压；体验不稳定 |
| C: 小屏改为分行（`flex-col sm:flex-row`）+ 筛选区横向滚动 | 适配稳定，可用性更好 | 改动略多，需要回归桌面端 |
**决策**: 选择 A + C
**理由**: A 解决“竖排”根因，C 解决“小屏拥挤”根因，两者结合最稳
**影响**: `frontend/src/components/media/AllUploadImageModal.vue`
