# 变更提案: 聊天手势与弹层交互增强

## 需求背景
当前聊天相关页面以点击为主：
- 消息列表（`ChatSidebar`）仅支持点击切换“消息/收藏”，移动端单手操作成本较高
- 聊天界面（`ChatRoomView`）返回列表依赖顶部返回按钮，缺少常见的边缘右滑返回
- 长按用户触发的更多菜单在移动端存在“释放后被点击事件冒泡关闭/或需要更稳定的点击外关闭”的交互问题
- 侧边栏抽屉仅支持点击遮罩关闭，缺少滑动关闭

本变更目标是在不破坏滚动/下拉刷新/长按的前提下，补齐移动端常用手势交互并统一弹层关闭行为。

## 产品分析

### 目标用户与场景
- **用户群体:** 移动端为主的聊天用户；单手操作、频繁切换会话/收藏
- **使用场景:** 会话列表快速浏览与切换；聊天过程中快速返回列表；侧边栏抽屉查看会话并关闭
- **核心痛点:** 依赖精准点击（切换 Tab/关闭抽屉/返回列表）；长按菜单关闭行为不稳定

### 价值主张与成功指标
- **价值主张:** 降低操作摩擦，提升移动端一只手的可用性与一致性
- **成功指标:**
  - 列表页可用左右滑切换“消息/收藏”，且不误触发下拉刷新
  - 聊天页支持从屏幕左边缘右滑返回列表，误触率可接受（不影响消息滚动）
  - 侧边栏抽屉支持滑动关闭
  - 长按更多菜单：点击/触摸其它位置可关闭，且长按后释放不会立即关闭

### 人文关怀
- 尽量减少误触与突兀跳转（采用边缘触发与方向优先判定）
- 不引入强制全局 `touch-action: none`，避免破坏可访问性与浏览器默认滚动行为

## 变更内容
1. 消息列表支持左右滑动切换“消息/收藏”
2. 聊天界面支持屏幕左边缘右滑返回列表（等价于点击返回按钮）
3. 长按用户的更多菜单：点击/触摸其它位置隐藏，且长按释放不应立即关闭
4. 侧边栏抽屉支持在面板内向左滑关闭
5. 下拉刷新组件规避横向滑动误判（避免与左右滑手势冲突）

## 影响范围
- **模块:**
  - 前端聊天 UI（`ChatSidebar` / `ChatRoomView`）
  - 公共组件（`PullToRefresh`）
- **文件:**
  - `frontend/src/components/chat/ChatSidebar.vue`
  - `frontend/src/views/ChatRoomView.vue`
  - `frontend/src/components/common/PullToRefresh.vue`
- **API:** 无
- **数据:** 无

## 核心场景

### 需求: 消息列表滑动切换
**模块:** 前端聊天 UI
在消息列表中通过左右滑动切换“消息/收藏”。

#### 场景: 列表页左右滑切换
在 `/list` 页面（完整列表页）左右滑动。
- 预期结果: 左滑从“消息”切到“收藏”；右滑从“收藏”切回“消息”
- 预期结果: 不影响列表纵向滚动；不误触发下拉刷新

#### 场景: 聊天页侧边栏内左右滑切换
在聊天页打开侧边栏抽屉后，在抽屉内左右滑动切换。
- 预期结果: 左右滑切换规则同列表页
- 预期结果: 与“抽屉左滑关闭”不冲突（通过触发区域与阈值规避）

### 需求: 聊天页边缘右滑返回列表
**模块:** 前端聊天 UI
在聊天界面从屏幕左边缘向右滑返回列表。

#### 场景: 左边缘右滑返回
从屏幕左边缘起手右滑。
- 预期结果: 触发 `handleBack()`，退出当前会话并返回 `/list`
- 预期结果: 不影响消息列表的正常滚动与输入区交互

### 需求: 侧边栏抽屉滑动关闭
**模块:** 前端聊天 UI
侧边栏抽屉打开时，可在面板内向左滑关闭。

#### 场景: 抽屉面板内左滑关闭
抽屉打开状态下，在抽屉面板内向左滑。
- 预期结果: 抽屉关闭（等价于点击遮罩关闭）
- 预期结果: 不与抽屉内“左右滑切换 Tab”冲突（采用触发区域与阈值规避）

### 需求: 长按更多菜单点击外关闭
**模块:** 前端聊天 UI
长按用户触发的更多菜单，点击/触摸其它位置应隐藏。

#### 场景: 长按后菜单保持打开
长按用户条目触发菜单后松手。
- 预期结果: 菜单保持打开，不被随后的 click 冒泡立即关闭

#### 场景: 点击/触摸其它位置隐藏
菜单打开时，点击列表空白处或其它区域。
- 预期结果: 菜单隐藏
- 预期结果: 点击菜单内部按钮不触发外部关闭（除非按钮逻辑主动关闭）

## 风险评估
- **风险:** 左右滑/边缘右滑 与 纵向滚动/下拉刷新/长按存在手势冲突
- **缓解:**
  - 引入“方向优先判定”（水平距离大于垂直距离时不触发下拉刷新）
  - 边缘手势采用“左边缘起手”限制误触
  - 抽屉关闭采用“抽屉右侧边缘起手”限制，避免与 Tab 左右滑切换冲突

