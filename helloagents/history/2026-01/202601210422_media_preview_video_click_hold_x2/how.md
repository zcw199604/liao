# 技术设计: MediaPreview 视频交互增强（单击播放/暂停、点击浮现三按钮、长按2倍速、滑动快进/音量、按钮美化）

## 技术方案

### 核心技术
- Vue 3 + `<script setup>`
- HTML5 `<video>` + Plyr（现有）
- Pointer Events（长按/按住交互，兼容 touch/mouse）
 - 轻量手势识别（水平/垂直方向锁定）

### 实现要点

#### 1) 单击播放/暂停
- 在视频容器/元素上增加 click 处理：触发播放/暂停切换，并同时触发“控制按钮浮现”（见 3）。
- 优先使用 Plyr 实例（如已初始化）调用其 `play()` / `pause()` / `toggle` 能力，以保证控制栏 UI 状态同步；无 Plyr 时再回退到原生 `video`。
- 为避免与 Plyr 的默认“点击播放”行为叠加，显式关闭 Plyr 的 `clickToPlay`（或在自定义处理器中阻断事件传播）。
- 处理浏览器手势/自动播放限制导致的 `play()` Promise reject：以提示或静默降级方式处理，避免抛错影响 UI。

#### 2) 长按临时 2x 倍速
- 将“倍速选择”从原生 `<select>` 调整为“按钮 + 下拉菜单”，以便可靠捕获 long-press（移动端更稳定）。
- 维护两类状态：
  - `basePlaybackRate`：用户选择并持久化的倍速（保持现有 localStorage 行为）。
  - `tempBoosting`：长按期间的临时加速态（不持久化）。
- `tempBoosting=true` 时：
  - 优先通过 Plyr 实例设置 `speed = 2`（确保 UI 同步）；无 Plyr 时再设置 `video.playbackRate = 2`。
  - `defaultPlaybackRate` 始终保持 `basePlaybackRate`，避免污染默认值。
  - 松开/取消后恢复到 `basePlaybackRate`。
- 记录长按开始时的 `paused` 状态：
  - 若长按触发时原本暂停：按住期间可自动播放，释放时回到暂停（防止状态漂移）。
  - 若原本播放：释放时保持播放，仅恢复倍速。
- 移动端注意事项：
  - 长按需设置阈值（建议 250~350ms）区分点击与长按，避免“短按被误判为长按”或反之。
  - 避免 iOS 长按触发系统菜单：在长按热区阻止 `contextmenu`，并按需使用 `-webkit-touch-callout: none` 等样式降级。

#### 3) 单击浮现“倒退/播放暂停/快进”三按钮（1 秒自动隐藏）
- 在视频区域上层添加一个轻量 overlay（绝对定位、居中布局），默认隐藏。
- “单击”建议不直接依赖 `click` 事件，而用 `pointerdown/move/up` 组合判定（与手势互斥），避免滑动结束后误触发 click。
- 判定为“单击”时：
  - 触发 overlay 显示；
  - 启动/重置 1 秒隐藏定时器（无交互则隐藏）。
  - 同时执行播放/暂停切换（满足“单击播放/暂停”需求）。
- 点击三按钮时：
  - 倒退/快进：按固定步长 seek（例如 ±10s，可配置）；并重置隐藏定时器。
  - 播放/暂停：切换播放状态；按钮图标随状态变化（播放/暂停）。
- 交互冲突规避：
  - overlay 只覆盖画面区域，不遮挡 Plyr 控制栏（避免影响进度条/音量/全屏点击）。
  - overlay 处于隐藏状态时不拦截指针事件（`pointer-events: none`），仅按钮可点击（按钮区域 `pointer-events: auto`）。

#### 4) 视频区域手势：左右滑动快进/倒退，上下滑动调音量
- 手势识别建议使用 Pointer Events（`pointerdown/move/up/cancel`）并实现“手势仲裁 + 方向锁定”：
  - 仲裁目标：Tap（单击） / Swipe（滑动）互斥；滑动一旦成立，需取消单击判定；（倍速长按发生在倍速按钮上，独立仲裁）。
  - 起始移动超过阈值后（例如 8~12px）锁定为水平或垂直，避免抖动导致混合。
  - 水平方向：基于 `dx` 映射到 `seekDeltaSec`（例如 100px≈10s）；更新建议优先用 Plyr `player.currentTime = target`，以同步 UI。
  - 垂直方向：基于 `dy` 映射到 `volumeDelta`（例如 150px≈100%）；更新建议优先用 Plyr `player.volume = v`，以同步 UI（并做 0~1 clamp）。
- 边界与降级：
  - `duration` 不可用或 `NaN`：seek 逻辑改为相对增量但仍需 clamp 到 `[0, currentTime+delta]`，并对异常值保护。
  - iOS/Safari（移动端）通常禁止网页脚本修改音量：建议直接禁用“上下滑动调音量”，改为提示用户使用物理按键（或仅在非 iOS 启用）。
  - 避免触发浏览器默认滚动：在手势激活后再 `preventDefault`（并确保监听器非 passive），减少对页面其它区域的影响。
- 与单击/长按关系：
  - 触发手势时应取消“单击切换播放/暂停”的点击判定（避免滑动结束触发 click）。
  - 手势期间可保持 overlay 显示，并重置隐藏计时（提升可发现性）。

#### 3) 抓帧/抽帧按钮美化
- 调整为与顶部工具栏一致的“玻璃态”action bar：
  - 背景半透明 + `backdrop-blur` + 细边框 + 轻阴影。
- 按钮采用统一尺寸/圆角/hover/focus；主色通过 icon/细 ring 表达，避免大面积纯色块造成突兀。
- 保持现有的 loading/disabled/tooltip 文案与逻辑不变。

## 架构设计
无新增模块，无跨模块依赖变更；变更局限于 `MediaPreview` 组件内交互与样式。

## 安全与性能
- **安全:** 不引入新的跨域读取能力；抓帧仍遵循浏览器 `SecurityError` 限制与现有提示逻辑。
- **性能:** 长按仅涉及少量定时器与播放速率切换；下拉菜单外点关闭如使用全局监听，需在关闭/卸载时移除，避免泄漏。

## 测试与部署
- **测试:**
  - `cd frontend && npm run build`
  - 手动验证：单击切换播放/暂停；长按触发临时 2x 并恢复；抓帧/抽帧按钮视觉与交互；移动端触摸场景
- **部署:** 前端构建与发布流程保持不变
