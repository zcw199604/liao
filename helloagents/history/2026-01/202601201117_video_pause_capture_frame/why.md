# 变更提案: 视频播放暂停抓帧与倍速/慢放

## 需求背景
当前系统已支持“视频抽帧任务”（后端 ffmpeg 异步批量抽帧），但在视频预览播放过程中缺少“暂停后抓取当前这一帧”的快速能力，导致用户在挑选某一瞬间画面时需要通过抽帧任务或外部工具绕行。

本提案新增“视频预览倍速/慢放 + 暂停抓帧”能力，用于更准确定位并抓取目标帧，抓帧结果支持“直接下载 + 上传到图片库”。

## 产品分析

### 目标用户与场景
- **用户群体:** 在聊天/媒体库内浏览视频素材并需要快速截取关键画面的用户
- **使用场景:** 预览视频 → 调整倍速/慢放 → 暂停在目标瞬间 → 一键抓帧并保存/复用
- **核心痛点:** 无法在预览播放过程中快速抓取“当前帧”；缺少倍速/慢放辅助导致定位困难

### 价值主张与成功指标
- **价值主张:** 低成本提升选帧效率与准确性，减少抽帧任务与外部工具依赖
- **成功指标:** 用户可在预览中完成“倍速定位 → 暂停 → 抓帧下载 + 上传”；抓帧失败时可获得明确原因与替代路径提示

### 人文关怀
抓帧图片可能包含隐私内容；应避免额外采集/上传非用户主动操作的内容，仅在用户触发“抓帧”时生成并上传。

## 变更内容
1. 视频预览支持倍速/慢放（默认档位：0.1/0.25/0.5/1/1.5/2/5）
2. 支持暂停后抓取当前帧生成图片，并同时执行“直接下载 + 上传到图片库”
3. 对跨域/未就绪/未登录等抓帧失败场景提供明确提示与降级路径

## 影响范围
- **模块:** 前端媒体预览（`MediaPreview`）
- **文件:** `frontend/src/components/media/MediaPreview.vue`（预计为主）
- **API:** 无新增（复用现有上传能力）
- **数据:** 无变更

## 核心场景

### 需求: 暂停抓帧（下载+上传）
**模块:** 前端媒体预览（MediaPreview）
用户在视频预览中定位到目标瞬间，希望暂停后抓取这一帧并保存/复用。

#### 场景: 暂停后抓取当前帧并生成图片
用户在视频预览中播放或已暂停：
- 用户点击“抓帧”后得到一张图片
- 图片会同时“直接下载”到本地，并“上传到图片库”（可在上传列表中继续使用/发送）

#### 场景: 跨域视频无法抓帧时提示
视频来源跨域且无 CORS 允许时：
- 抓帧失败给出明确提示（跨域/CORS 限制）
- 提示可选替代方案（如先上传到本地库或使用抽帧任务）

### 需求: 倍速/慢放控制
**模块:** 前端媒体预览（MediaPreview）
用户希望通过倍速与慢放更准确定位到目标帧。

#### 场景: 切换倍速后播放/暂停
用户在视频预览中切换倍速档位：
- 播放速度立即生效（含慢放）
- 用户可在任意时刻暂停，暂停后点击“抓帧”抓取当前画面

## 风险评估
- **风险:** Canvas 抓帧对跨域资源可能因 CORS 限制失败；高分辨率视频抓帧可能带来瞬时内存/CPU 峰值；抓帧图片可能包含隐私内容。
- **缓解:** 失败时给出明确提示并引导替代方案；仅生成单帧并及时释放资源；上传仅在用户触发抓帧时执行，且要求用户已选择身份/登录。

