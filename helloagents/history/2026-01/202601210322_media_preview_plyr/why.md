# 变更提案: 媒体预览视频播放器升级为 Plyr

## 需求背景

当前前端视频预览使用原生 `<video controls>`，在视觉一致性与交互体验上存在不足（控件样式受浏览器影响较大、暂停时可能出现遮罩图标遮挡画面）。与此同时，`MediaPreview` 已提供倍速、暂停抓帧、抽帧任务等能力，改动播放器实现时必须保证这些既有能力不回退。

## 变更内容

1. 在 `MediaPreview` 的“主视频预览”中引入 Plyr，以获得更现代、可主题化的控制栏 UI（暗色风格更一致）。
2. 保持现有功能行为一致：倍速（含持久化）、暂停抓帧（下载 + 可选上传）、抽帧入口、详情面板、下载逻辑、画廊切换与快捷键等。
3. 完善知识库：整理当前“图片/视频预览”所支持的功能与边界说明，作为回归基线与后续演进依据。

## 影响范围

- **模块:** 前端媒体预览（MediaPreview）
- **文件:**
  - `frontend/src/components/media/MediaPreview.vue`
  - `frontend/package.json`
  - `frontend/package-lock.json`
  - `helloagents/wiki/modules/media.md`
  - `helloagents/CHANGELOG.md`
- **API:** 无
- **数据:** 无

## 核心场景

### 需求: 视频预览体验升级且不回退

**模块:** MediaPreview

#### 场景: 预览视频（播放/暂停/定位）

- 控制栏 UI 更现代且统一（Plyr）
- 支持播放/暂停、进度拖动、音量与全屏（至少与原生一致）
- 不影响快捷键：`Esc` 关闭、`←/→` 切换（画廊模式）

#### 场景: 倍速与抓帧

- 倍速档位与持久化（`media_preview_playback_rate`）行为不变
- 暂停抓帧仍可用：生成 PNG、下载；有身份时上传到图片库

#### 场景: 画廊与信息

- 画廊切换、缩略图（含>200虚拟滚动）、`media-change` 事件行为不变
- 详情面板按元信息显示与按需解析真实文件名行为不变

## 风险评估

- **风险:** 引入第三方依赖可能带来样式覆盖与初始化时序问题（切换媒体/关闭弹层时销毁不当会导致残留 DOM 或事件泄露）。
- **缓解:** 仅在主预览为视频且弹层可见时初始化；在媒体切换/关闭/卸载时可靠销毁实例；保留原生 `controls` 作为失败回退。

